

프론트에서 HTML5 GEOLOCATION API 사용하여 사용자의 현재위치를받고 서버에 그 위치를 post -> 서버는 Google Maps Geocoding API(주소->좌표 좌표->주소) 활용하여 db에 


[JHS] [오후 3:09] 그럼 그냥 전체게시물다 사용가능으로 하고 게시물을 올릴때만 위치정보 받아와서 등록하게 하고 위치 셀렉트 만들어서 그위치에 해당하는 게시물만 매핑해서 보게 하는건?
[JHS] [오후 3:09] 그리고 로그인 안한사람들은 게시물 클릭하면 로그인 필요한 서비스로 튕기고


게시물을 올릴떄마다 위치를넣어줘라..?

게시글 post에 위치설정을 실시간사용자위치를넣어줘야할지 희망하는 위치를넣어줘야할지정해야함 . 
현재위치를 받는 시나리오

게시글 작성후에 내위치설정 버튼클릭 (Get)-> 위치정보를 서버에전달후 가공해서 ~~동으로 반환해서 넘겨주기 ?

우리동네 주변게시물보기 버튼클릭 (Get) -> 위치정보를 서버에 전달후 반경계산해서 게시물반환해주기 ?


프론트에 내위치설정하는 버튼 혹은 컴포넌트를 하나 만들어봅시다. 

사용자위치설정버튼 (현재 위치를 설정함 . 상태변수 관리) -> 게시물 post시 위치설정 되있지않으면 설정하게끔 만드는거 필요함 , 1번의 사용자위치설정버튼과 같은 기능의 버튼 (게시물에 사용자위치속성 추가)
db에 사용자 위치저장 , 
서버는 우리동네 게시물보기 클릭시 반경을계산하는 api가 필요, 우리동네게시물 get api는 사용자위치로부터 반경 5키로안에있는 게시물만 보여주는 기능 .

사용자 : 위치설정 -> 좌표를 서버에서 역 지오코딩을통해 주소로 변환 (~~동) db에 유저테이블에  location 속성에 저장 // 여기까지 일단 해봅시다 .

location 속성이 저장된다면 ,게시글 post api에 그 주소를 반환하는 json 객체에 포함시켜봅시다 .

포함이 되었다면 
우리동네 게시물보기 api를 만들어봅시다 ( 반경 5키로를 계산하는 공식 혹은 api사용으로 사용자가 좌표 혹은 주소를보낸다면 그 반경에있는 게시물만 get요청에서 반환될 수 있게끔 .) 



사용자위치설정버튼 (현재 위치를 설정함 . 상태변수 관리) -> 게시물 post시 위치설정 되있지않으면 설정하게끔 만드는거 필요함 , 1번의 사용자위치설정버튼과 같은 기능의 버튼 (게시물에 사용자위치속성 추가)
db에 사용자 위치저장 , 
서버는 우리동네 게시물보기 클릭시 반경을계산하는 api가 필요, 우리동네게시물 get api는 사용자위치로부터 반경 5키로안에있는 게시물만 보여주는 기능 .

이런식으로 할 예정이거든 ? 
일단 사용자의 위치를 리액트에서는 HTML5 GEOLOCATION API를 사용해서 사용자의 현재좌표를 사용한다고 가정했을때, 
좌표로 넘어오는걸  구글 GEOCODING API 역지오코딩을통해서 그 사용자의 좌표를 주소로 변환받고 그걸 이제 




HTML5 geolocation API 사용중 문제점 : 지금 내위치는 인천 미추홀구이다 . 근데 화성시로나오고있음 .

현재위치를 받는버튼은 모바일환경에서 권장하도록하고 , 데스크톱환경에서 위치를 받을때는 ??시 ??구 ??동 이렇게 받도록해야할것같다 geoLocationAPI 가 구글 , HTML5 등 어떤 api를 사용하더라도
desktop에서 사용했을시에는 위치가 크게 차이가나기때문이다 , 



위치지정버튼 -> 모바일환경에서는 현재위치 
pc버전 위치설정은 검색해서 받을수있게끔 해야할듯하다 .

그리고 받은 유저들의 좌표로 반경계산해서 반경안에들어있는 게시물들만 get이되는 우리동네 게시물보기 API 작성 .


모바일환경에서 매끄럽게가능한 좌표설정버튼 완성 . (데스크톱에선 gps , wifi를 사용하지않아 정확한위치가 표시되지않음 .)
 설정과정 :   브라우저의 내위치설정 -> html5 geolocation API 에서제공하는 현재 내위치 좌표얻기 -> 서버에 lat ,lng 전송 -> lat lng를 google map platform의 reverseGeocode() 메서드에 매개변수로 전달 
-> 동 단위의 주소 반환


위치받는방법 2가지가있어야되고 ,
첫번쨰는 구현이끝난상태


두번쨰는 검색해서 직접 위치를 지정하게끔하는방법 

지역변경이라는 모달이뜰때 , 대한민국에 모든 동을 get 으로 
대한민국의 모든 동 -> 우리데이터베이스에서 뿌려주는건지 ? 아니면 지역변경 버튼을 클릭했을때 API요청을해서 모든동을 API가 보내주는것인지 ? 
onClick -> get요청 ? 서버에서 get요청은 내 데이터베이스의



주소를 선택(클릭) 할때에 좌표와 주소가 전송되게끔 로직작성 .
로직은 일관성있게 좌표를 주소로 변환하여 저장할 수 있게끔 작성 



지금 로직에서는 HTML5 Geolocation API , google places API 두개를 사용해서 사용자의 실시간위치정보 , 검색된 사용자의 위치정보 두가지를 지정해서 데이터를 가공후
좌표를 서버에전송- >  서버는 좌표, 역지오코딩을통한 주소 (읍면동명) 을 user테이블에 lat , lng , address 컬럼에 각 유저마다 저장한다 ,
이때 address 컬럼에 읍면동명이 일관성있게 저장되지않는 오류를 해결하기위해서 기존 google geocoding API 와 라이브러리를 사용하던것을 카카오 API로 대체해 
자체 DB에 국토교통부 전국 법정동 파일을 저장시켰고 , kakao GeocodingAPI 에 역지오코딩을요청하여  공통으로 사용하는 법정동코드를 매핑시켜  address컬럼에 저장하려고한다 .

documents[0].b_code


서버 최종수정완료


HTML5 Geolocation API , google places API 를통해 좌표를 얻음 -> 서버에서 좌표 -> 법정동코드변환(카카오로컬 Rest API)  , 법정동코드 -> 주소변환(자체DB에서 가져옴) -> userDB Address 저장 

프론트수정 -> onclick으로 검색에서 자동완성된 주소를 클릭했을때 서버에 요청이가게끔 수정 .















